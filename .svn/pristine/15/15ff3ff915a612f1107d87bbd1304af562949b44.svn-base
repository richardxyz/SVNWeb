webpackJsonp([77],{HLT6:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("Xxa5"),a=s.n(i),n=s("exGp"),o=s.n(n),l=s("woOf"),c=s.n(l),r=s("Dd8w"),d=s.n(r),u=s("bH6Z"),p=s("4s4v"),v=s("IYcQ"),m=s("UMo0"),f=s("NYxO"),g={components:{SyElTable:u.a,pageSize:v.default},mounted:function(){console.log(this.cellList)},created:function(){this.initEquipmentList()},computed:d()({},Object(f.e)(["gstylelast","mySalePlans","parkLotInfo"]),{parkIist:function(){return this.$store.state.ONEreslist}},Object(f.c)({equipmentList:"getEquipmentList",parkingLotInfo:"getParkingLotInfo",parkingLotDevList:"getParkingLotDevList",cellList:"getCellList"})),data:function(){return{addBox:!1,imgBox:!1,editBox:!1,realBox:!1,search:{codestyle:"",deviceId:"",id:""},paging:{page:1,pageSize:10,total:0},arrtable:[],equipment:{eid:0,id:"",location:"",lattice:"",deviceId:"",cabinet:"",color:"",codestyle:"",typeName:"",email:"",code:"",state:0},deviceId:0,rules:p.e}},methods:d()({},Object(f.b)(["initEquipmentList","toAddEquipment","toEditEquipment","getRealBox","toDeletEquipment"]),{lck:function(e){console.log(file)},tijiao:function(){var e=this;console.log(this.deviceId);var t="";this.arrtable.forEach(function(e,s){t+=e+","}),t=t.substring(0,t.length-1),console.log(t);var s={file:t,eid:this.deviceId};Object(m.C)(s).then(function(t){0==t.data.resCode?(e.$message({message:"保存成功",type:"success"}),e.imgBox=!1):e.$message({message:"保存失败",type:"success"})})},handleSearchClick:function(){this.initEquipmentList(this.search)},handleRemove:function(e,t){console.log(e,t)},clear:function(){this.equipment={id:"",location:"",lattice:"",deviceId:"",cabinet:"",color:"",typeName:"",codestyle:"",email:"",code:"",state:0,eid:0}},indexMethod:function(e){return e+(this.paging.page-1)*this.paging.pageSize+1},pageInfo:function(e){this.initEquipmentList({page:e.currentPage,pagesize:e.pageSize})},ClickAddEquipment:function(e){var t=this;this.$refs[e].validate(function(e){e&&t.toAddEquipment(t.equipment).then(function(e){console.log(e),e&&(t.addBox=!1,t.$message({message:"添加成功",type:"success"}),t.initEquipmentList())})})},ClickEditEquipment:function(e){var t=this;this.$refs[e].validate(function(e){e&&(console.log(t.equipment),t.toEditEquipment(t.equipment).then(function(e){console.log(e),e&&(t.addBox=!1,t.$message({message:"修改成功",type:"success"}),t.initEquipmentList())}))})},ClickDeleteequipment:function(e,t){var s=this;this.$confirm("确认删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){s.toDeletEquipment({eid:e,deviceid:t}).then(function(e){console.log(e),e&&(s.$message({type:"success",message:"删除成功!"}),s.initEquipmentList())})}).catch(function(){s.$message({type:"info",message:"已取消删除"})})},handleEditequipment:function(e){var t=this.$store.getters.getEquipment(e);console.log(t),c()(this.equipment,t),this.editBox=!0,this.addBox=!0},hangd:function(e,t){1==t.length&&this.$message({type:"error",message:"最多添加一个apk文件"})},hangds:function(e,t){5==t.length&&this.$message({type:"error",message:"最多上传5张图片"})},requasts:function(e){var t=this;return o()(a.a.mark(function s(){var i,n,o;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(i=new FormData).append("file",e.file),n={headers:{"Content-Type":"multipart/form-data"}},t.next=5,Object(m.r)(i,n);case 5:0==(o=t.sent).data.resCode&&console.log(o);case 7:case"end":return t.stop()}},s,t)}))()},beforeAvatarUpload:function(e){var t=e.size/1024/1024<2;return t||this.$message.error("上传头像图片大小不能超过 2MB!"),t},requast:function(e){var t=this;return o()(a.a.mark(function s(){var i,n,o;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return(i=new FormData).append("file",e.file),n={headers:{"Content-Type":"multipart/form-data"}},s.next=5,Object(m._36)(i,n);case 5:0==(o=s.sent).data.resCode&&(console.log(o),console.log(o.data.imageUrl),t.$message.success("上传图片成功"),t.arrtable.push(o.data.imageUrl));case 7:case"end":return s.stop()}},s,t)}))()},handleset:function(e){this.deviceId=e,this.imgBox=!0},handleRealTime:function(e){this.deviceId=e,this.getRealBox({id:e})&&(console.log(this.$store.state,this.cellList),this.realBox=!0)}})},_={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"equipmentList"}},[e._m(0),e._v(" "),s("div",{staticClass:"select"},[s("span",[e._v("停车场名称：")]),e._v(" "),s("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.search.id,callback:function(t){e.$set(e.search,"id",t)},expression:"search.id"}},[s("el-option",{attrs:{label:"未选择"}}),e._v(" "),e._l(e.parkIist,function(e){return s("el-option",{key:e.id,attrs:{label:e.parking_name,value:e.parking_id}})})],2),e._v(" "),s("span",[e._v("设备编号：")]),e._v(" "),s("el-input",{attrs:{clearable:"",placeholder:"请输入内容"},model:{value:e.search.deviceId,callback:function(t){e.$set(e.search,"deviceId",t)},expression:"search.deviceId"}})],1),e._v(" "),s("div",{staticClass:"select"},[s("el-button",{staticClass:"oyButton",attrs:{type:"success",icon:"el-icon-plus"},on:{click:function(t){e.addBox=!0,e.editBox=!1,e.clear()}}},[e._v("添加")]),e._v(" "),s("el-button",{staticClass:"oyButton",attrs:{type:"success",icon:"el-icon-search"},on:{click:e.handleSearchClick}},[e._v("查询")]),e._v(" "),s("el-button",{staticClass:"oyButton",attrs:{type:"success",icon:""},on:{click:e.downapk}},[e._v("下载文件")])],1),e._v(" "),s("div",{staticClass:"Content"},[s("el-table",{staticClass:"oyTable",staticStyle:{width:"100%"},attrs:{data:e.equipmentList.list}},[s("el-table-column",{attrs:{type:"index",index:e.indexMethod,label:"序号",width:"100"}}),e._v(" "),s("el-table-column",{attrs:{label:"停车场名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-popover",{attrs:{trigger:"hover",placement:"top"}},[s("p",{staticClass:"TsMaxWidth"},[e._v(e._s(t.row.parking_name))]),e._v(" "),s("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[s("div",{staticClass:"overflowHide"},[e._v(e._s(t.row.parking_name))])])])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"钥匙柜名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-popover",{attrs:{trigger:"hover",placement:"top"}},[s("p",{staticClass:"TsMaxWidth"},[e._v(e._s(t.row.codestyle))]),e._v(" "),s("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[s("div",{staticClass:"overflowHide"},[e._v(e._s(t.row.codestyle))])])])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"钥匙柜地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-popover",{attrs:{trigger:"hover",placement:"top"}},[s("p",{staticClass:"TsMaxWidth"},[e._v(e._s(t.row.boxId))]),e._v(" "),s("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[s("div",{staticClass:"overflowHide"},[e._v(e._s(t.row.boxId))])])])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"钥匙柜编号"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-popover",{attrs:{trigger:"hover",placement:"top"}},[s("p",{staticClass:"TsMaxWidth"},[e._v(e._s(t.row.deviceId))]),e._v(" "),s("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[s("div",{staticClass:"overflowHide"},[e._v(e._s(t.row.deviceId))])])])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"钥匙柜状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[s("el-tag",{attrs:{color:"1"==t.row.state?"#f8c541":"#5daf34"}},[e._v(e._s("1"==t.row.state?"已使用":"未使用"))])],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"设置",placement:"top"}},[s("i",{staticClass:"icon-change el-icon-setting",on:{click:function(s){e.handleset(t.row.eid)}}})]),e._v(" "),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"实时柜门",placement:"top"}},[s("i",{staticClass:"icon-See el-icon-search",on:{click:function(s){e.handleRealTime(t.row.deviceId)}}})]),e._v(" "),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"修改",placement:"top"}},[s("i",{staticClass:"icon-change el-icon-edit",on:{click:function(s){e.handleEditequipment(t.row.eid)}}})]),e._v(" "),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top"}},[s("i",{staticClass:"icon-delete el-icon-delete",on:{click:function(s){e.ClickDeleteequipment(t.row.eid,t.row.deviceId)}}})])]}}])})],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"柜门信息 设备编号："+e.deviceId,visible:e.realBox},on:{"update:visible":function(t){e.realBox=t}}},[s("div",{staticClass:"shebeiguanli-box"},e._l(e.cellList,function(t,i){return s("el-tooltip",{key:i,attrs:{placement:"top",title:"标题",width:"200",trigger:"hover"}},[s("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n          柜号："+e._s(t.cabinet)+"\n          "),s("br"),e._v(" 名称："+e._s(t.type_name)+"\n          "),s("br"),e._v(" 柜子地址："+e._s(t.email)+"\n          "),s("br"),e._v(" 开柜码："+e._s(t.number)+"\n          "),s("br"),e._v(" 状态："+e._s(e._f("box_state")(t.openstate))+"\n        ")]),e._v(" "),s("div",{class:["shebeiguanli-box-cell","0"===t.openstate?"green":"yellow"]})])})),e._v(" "),s("el-row",{staticStyle:{"text-align":"right","margin-top":"20px"}},[s("el-button",{attrs:{type:"success"},on:{click:function(t){e.realBox=!1}}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"上传图片",visible:e.imgBox},on:{"update:visible":function(t){e.imgBox=t}}},[s("div",[s("span",[e._v("上传储物柜图片")]),e._v(" "),s("br"),e._v(" "),s("br"),e._v(" "),s("el-upload",{attrs:{action:"https://jsonplaceholder.typicode.com/posts/","list-type":"picture-card",limit:5,"on-exceed":e.hangds,"before-upload":e.beforeAvatarUpload,"http-request":e.requast,"on-remove":e.handleRemove}},[s("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),s("div",{staticStyle:{"text-align":"center"}},[s("span",[e._v("上传储物柜apk文件")]),e._v(" "),s("br"),e._v(" "),s("br"),e._v(" "),s("el-upload",{staticClass:"upload-demo",attrs:{drag:"","on-preview":e.lck,"on-exceed":e.hangd,limit:1,"http-request":e.requasts,multiple:""}},[s("i",{staticClass:"el-icon-upload"}),e._v(" "),s("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或\n          "),s("em",[e._v("点击上传")])])])],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticClass:"oyButton",attrs:{type:"success"},on:{click:function(t){e.imgBox=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{staticClass:"oyButton",attrs:{type:"success"},on:{click:function(t){e.tijiao()}}},[e._v("提交")])],1)]),e._v(" "),s("el-dialog",{attrs:{title:e.editBox?"查看修改钥匙柜":"添加钥匙柜",visible:e.addBox},on:{"update:visible":function(t){e.addBox=t}}},[s("el-form",{ref:"equipment",attrs:{inline:!0,model:e.equipment,rules:e.rules}},[s("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"end"}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"停车场",prop:"id"}},[s("el-select",{attrs:{placeholder:"请选择",disabled:e.editBox},model:{value:e.equipment.id,callback:function(t){e.$set(e.equipment,"id",t)},expression:"equipment.id"}},[s("el-option",{key:"",attrs:{value:"",label:"未选择"}}),e._v(" "),e._l(e.parkIist,function(e){return s("el-option",{key:e.id,attrs:{label:e.parking_name,value:e.parking_id}})})],2)],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"颜色",prop:"color"}},[s("el-input",{model:{value:e.equipment.color,callback:function(t){e.$set(e.equipment,"color",t)},expression:"equipment.color"}})],1)],1)],1),e._v(" "),s("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"end"}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"钥匙柜地址",prop:"location"}},[s("el-input",{model:{value:e.equipment.location,callback:function(t){e.$set(e.equipment,"location",t)},expression:"equipment.location"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"格数",prop:"cabinet"}},[s("el-input",{attrs:{disabled:e.editBox},model:{value:e.equipment.cabinet,callback:function(t){e.$set(e.equipment,"cabinet",t)},expression:"equipment.cabinet"}})],1)],1)],1),e._v(" "),s("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"end"}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"设备编号",prop:"deviceId"}},[s("el-input",{attrs:{disabled:e.editBox},model:{value:e.equipment.deviceId,callback:function(t){e.$set(e.equipment,"deviceId",t)},expression:"equipment.deviceId"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"钥匙柜名称",prop:"codestyle"}},[s("el-input",{model:{value:e.equipment.codestyle,callback:function(t){e.$set(e.equipment,"codestyle",t)},expression:"equipment.codestyle"}})],1)],1)],1),e._v(" "),s("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"end"}},[s("el-col",{attrs:{span:12}}),e._v(" "),s("el-col",{attrs:{span:12}})],1),e._v(" "),s("el-row",{staticStyle:{"text-align":"right"}},[s("el-button",{on:{click:function(t){e.addBox=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"success"},on:{click:function(t){e.editBox?e.ClickEditEquipment("equipment"):e.ClickAddEquipment("equipment")}}},[e._v("确 定")])],1)],1)],1),e._v(" "),s("div",{staticClass:"footer"},[s("pageSize",{attrs:{messages:e.equipmentList.count},on:{code:e.pageInfo}})],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"header"},[t("div",{staticClass:"headerTitle"},[t("span",[this._v("设备管理")])])])}]};var h=s("VU/8")(g,_,!1,function(e){s("u0RI")},"data-v-27240811",null);t.default=h.exports},u0RI:function(e,t){}});